


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    cassandra.query | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../../../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
    <script type="text/javascript" src="../../../_static/sphinx_tabs/tabs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="../../../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="/"><img src="../../../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">

        <div class="large-6 large-push-3 columns">
            <h1>Source code for cassandra.query</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright DataStax, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module holds classes for working with prepared statements and</span>
<span class="sd">specifying consistency levels and retry policies for individual</span>
<span class="sd">queries.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">cassandra</span> <span class="kn">import</span> <span class="n">ConsistencyLevel</span><span class="p">,</span> <span class="n">OperationTimedOut</span>
<span class="kn">from</span> <span class="nn">cassandra.util</span> <span class="kn">import</span> <span class="n">unix_time_from_uuid1</span>
<span class="kn">from</span> <span class="nn">cassandra.encoder</span> <span class="kn">import</span> <span class="n">Encoder</span>
<span class="kn">import</span> <span class="nn">cassandra.encoder</span>
<span class="kn">from</span> <span class="nn">cassandra.protocol</span> <span class="kn">import</span> <span class="n">_UNSET_VALUE</span>
<span class="kn">from</span> <span class="nn">cassandra.util</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">_sanitize_identifiers</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">UNSET_VALUE</span> <span class="o">=</span> <span class="n">_UNSET_VALUE</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Specifies an unset value when binding a prepared statement.</span>

<span class="sd">Unset values are ignored, allowing prepared statements to be used without specify</span>

<span class="sd">See https://issues.apache.org/jira/browse/CASSANDRA-7304 for further details on semantics.</span>

<span class="sd">.. versionadded:: 2.6.0</span>

<span class="sd">Only valid when using native protocol v4+</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">NON_ALPHA_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z0-9]&#39;</span><span class="p">)</span>
<span class="n">START_BADCHAR_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[^a-zA-Z0-9]*&#39;</span><span class="p">)</span>
<span class="n">END_BADCHAR_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z0-9_]*$&#39;</span><span class="p">)</span>

<span class="n">_clean_name_cache</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">_clean_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_clean_name_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">clean</span> <span class="o">=</span> <span class="n">NON_ALPHA_REGEX</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">START_BADCHAR_REGEX</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">END_BADCHAR_REGEX</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)))</span>
        <span class="n">_clean_name_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span>
        <span class="k">return</span> <span class="n">clean</span>


<div class="viewcode-block" id="tuple_factory"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.tuple_factory">[docs]</a><span class="k">def</span> <span class="nf">tuple_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns each row as a tuple</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from cassandra.query import tuple_factory</span>
<span class="sd">        &gt;&gt;&gt; session = cluster.connect(&#39;mykeyspace&#39;)</span>
<span class="sd">        &gt;&gt;&gt; session.row_factory = tuple_factory</span>
<span class="sd">        &gt;&gt;&gt; rows = session.execute(&quot;SELECT name, age FROM users LIMIT 1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print rows[0]</span>
<span class="sd">        (&#39;Bob&#39;, 42)</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        moved from ``cassandra.decoder`` to ``cassandra.query``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">rows</span></div>

<span class="k">class</span> <span class="nc">PseudoNamedTupleRow</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper class for pseudo_named_tuple_factory. These objects provide an</span>
<span class="sd">    __iter__ interface, as well as index- and attribute-based access to values,</span>
<span class="sd">    but otherwise do not attempt to implement the full namedtuple or iterable</span>
<span class="sd">    interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="n">ordered_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ordered_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuple</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{t}</span><span class="s1">(</span><span class="si">{od}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                  <span class="n">od</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pseudo_namedtuple_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns each row as a :class:`.PseudoNamedTupleRow`. This is the fallback</span>
<span class="sd">    factory for cases where :meth:`.named_tuple_factory` fails to create rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">PseudoNamedTupleRow</span><span class="p">(</span><span class="n">od</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">od</span> <span class="ow">in</span> <span class="n">ordered_dict_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">)]</span>


<div class="viewcode-block" id="named_tuple_factory"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.named_tuple_factory">[docs]</a><span class="k">def</span> <span class="nf">named_tuple_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns each row as a `namedtuple &lt;https://docs.python.org/2/library/collections.html#collections.namedtuple&gt;`_.</span>
<span class="sd">    This is the default row factory.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from cassandra.query import named_tuple_factory</span>
<span class="sd">        &gt;&gt;&gt; session = cluster.connect(&#39;mykeyspace&#39;)</span>
<span class="sd">        &gt;&gt;&gt; session.row_factory = named_tuple_factory</span>
<span class="sd">        &gt;&gt;&gt; rows = session.execute(&quot;SELECT name, age FROM users LIMIT 1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; user = rows[0]</span>

<span class="sd">        &gt;&gt;&gt; # you can access field by their name:</span>
<span class="sd">        &gt;&gt;&gt; print &quot;name: %s, age: %d&quot; % (user.name, user.age)</span>
<span class="sd">        name: Bob, age: 42</span>

<span class="sd">        &gt;&gt;&gt; # or you can access fields by their position (like a tuple)</span>
<span class="sd">        &gt;&gt;&gt; name, age = user</span>
<span class="sd">        &gt;&gt;&gt; print &quot;name: %s, age: %d&quot; % (name, age)</span>
<span class="sd">        name: Bob, age: 42</span>
<span class="sd">        &gt;&gt;&gt; name = user[0]</span>
<span class="sd">        &gt;&gt;&gt; age = user[1]</span>
<span class="sd">        &gt;&gt;&gt; print &quot;name: %s, age: %d&quot; % (name, age)</span>
<span class="sd">        name: Bob, age: 42</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        moved from ``cassandra.decoder`` to ``cassandra.query``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clean_column_names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">_clean_column_name</span><span class="p">,</span> <span class="n">colnames</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Row</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Row&#39;</span><span class="p">,</span> <span class="n">clean_column_names</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Failed creating namedtuple for a result because there were too &quot;</span>
            <span class="s2">&quot;many columns. This is due to a Python limitation that affects &quot;</span>
            <span class="s2">&quot;namedtuple in Python 3.0-3.6 (see issue18896). The row will be &quot;</span>
            <span class="s2">&quot;created with </span><span class="si">{substitute_factory_name}</span><span class="s2">, which lacks some namedtuple &quot;</span>
            <span class="s2">&quot;features and is slower. To avoid slower performance accessing &quot;</span>
            <span class="s2">&quot;values on row objects, Upgrade to Python 3.7, or use a different &quot;</span>
            <span class="s2">&quot;row factory. (column names: </span><span class="si">{colnames}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">substitute_factory_name</span><span class="o">=</span><span class="n">pseudo_namedtuple_factory</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="n">colnames</span><span class="o">=</span><span class="n">colnames</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pseudo_namedtuple_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">clean_column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_clean_column_name</span><span class="p">,</span> <span class="n">colnames</span><span class="p">))</span>  <span class="c1"># create list because py3 map object will be consumed by first attempt</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed creating named tuple for results with column names </span><span class="si">%s</span><span class="s2"> (cleaned: </span><span class="si">%s</span><span class="s2">) &quot;</span>
                    <span class="s2">&quot;(see Python &#39;namedtuple&#39; documentation for details on name rules). &quot;</span>
                    <span class="s2">&quot;Results will be returned with positional names. &quot;</span>
                    <span class="s2">&quot;Avoid this by choosing different names, using SELECT </span><span class="se">\&quot;</span><span class="s2">&lt;col name&gt;</span><span class="se">\&quot;</span><span class="s2"> AS aliases, &quot;</span>
                    <span class="s2">&quot;or specifying a different row_factory on your Session&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">clean_column_names</span><span class="p">))</span>
        <span class="n">Row</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Row&#39;</span><span class="p">,</span> <span class="n">_sanitize_identifiers</span><span class="p">(</span><span class="n">clean_column_names</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span></div>


<div class="viewcode-block" id="dict_factory"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.dict_factory">[docs]</a><span class="k">def</span> <span class="nf">dict_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns each row as a dict.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from cassandra.query import dict_factory</span>
<span class="sd">        &gt;&gt;&gt; session = cluster.connect(&#39;mykeyspace&#39;)</span>
<span class="sd">        &gt;&gt;&gt; session.row_factory = dict_factory</span>
<span class="sd">        &gt;&gt;&gt; rows = session.execute(&quot;SELECT name, age FROM users LIMIT 1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print rows[0]</span>
<span class="sd">        {u&#39;age&#39;: 42, u&#39;name&#39;: u&#39;Bob&#39;}</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        moved from ``cassandra.decoder`` to ``cassandra.query``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span></div>


<div class="viewcode-block" id="ordered_dict_factory"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.ordered_dict_factory">[docs]</a><span class="k">def</span> <span class="nf">ordered_dict_factory</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Like :meth:`~cassandra.query.dict_factory`, but returns each row as an OrderedDict,</span>
<span class="sd">    so the order of the columns is preserved.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        moved from ``cassandra.decoder`` to ``cassandra.query``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span></div>


<span class="n">FETCH_SIZE_UNSET</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<div class="viewcode-block" id="Statement"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.Statement">[docs]</a><span class="k">class</span> <span class="nc">Statement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract class representing a single query. There are three subclasses:</span>
<span class="sd">    :class:`.SimpleStatement`, :class:`.BoundStatement`, and :class:`.BatchStatement`.</span>
<span class="sd">    These can be passed to :meth:`.Session.execute()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">retry_policy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An instance of a :class:`cassandra.policies.RetryPolicy` or one of its</span>
<span class="sd">    subclasses.  This controls when a query will be retried and how it</span>
<span class="sd">    will be retried.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">consistency_level</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The :class:`.ConsistencyLevel` to be used for this operation.  Defaults</span>
<span class="sd">    to :const:`None`, which means that the default consistency level for</span>
<span class="sd">    the Session this is executed in will be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fetch_size</span> <span class="o">=</span> <span class="n">FETCH_SIZE_UNSET</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    How many rows will be fetched at a time.  This overrides the default</span>
<span class="sd">    of :attr:`.Session.default_fetch_size`</span>

<span class="sd">    This only takes effect when protocol version 2 or higher is used.</span>
<span class="sd">    See :attr:`.Cluster.protocol_version` for details.</span>

<span class="sd">    .. versionadded:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keyspace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The string name of the keyspace this query acts on. This is used when</span>
<span class="sd">    :class:`~.TokenAwarePolicy` is configured in the profile load balancing policy.</span>

<span class="sd">    It is set implicitly on :class:`.BoundStatement`, and :class:`.BatchStatement`,</span>
<span class="sd">    but must be set explicitly on :class:`.SimpleStatement`.</span>

<span class="sd">    .. versionadded:: 2.1.3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">custom_payload</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :ref:`custom_payload` to be passed to the server.</span>

<span class="sd">    These are only allowed when using protocol version 4 or higher.</span>

<span class="sd">    .. versionadded:: 2.6.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_idempotent</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flag indicating whether this statement is safe to run multiple times in speculative execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_serial_consistency_level</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_routing_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retry_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">serial_consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_size</span><span class="o">=</span><span class="n">FETCH_SIZE_UNSET</span><span class="p">,</span> <span class="n">keyspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">is_idempotent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">retry_policy</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">retry_policy</span><span class="p">,</span> <span class="s1">&#39;on_read_timeout&#39;</span><span class="p">):</span>  <span class="c1"># just checking one method to detect positional parameter errors</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;retry_policy should implement cassandra.policies.RetryPolicy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retry_policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry_policy</span> <span class="o">=</span> <span class="n">retry_policy</span>
        <span class="k">if</span> <span class="n">consistency_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span> <span class="o">=</span> <span class="n">consistency_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="n">routing_key</span>
        <span class="k">if</span> <span class="n">serial_consistency_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serial_consistency_level</span> <span class="o">=</span> <span class="n">serial_consistency_level</span>
        <span class="k">if</span> <span class="n">fetch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FETCH_SIZE_UNSET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetch_size</span> <span class="o">=</span> <span class="n">fetch_size</span>
        <span class="k">if</span> <span class="n">keyspace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyspace</span> <span class="o">=</span> <span class="n">keyspace</span>
        <span class="k">if</span> <span class="n">custom_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span> <span class="o">=</span> <span class="n">custom_payload</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_idempotent</span> <span class="o">=</span> <span class="n">is_idempotent</span>

    <span class="k">def</span> <span class="nf">_key_parts_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H</span><span class="si">%d</span><span class="s2">sB&quot;</span> <span class="o">%</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_routing_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span>

    <span class="k">def</span> <span class="nf">_set_routing_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_parts_packed</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">_del_routing_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">routing_key</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_routing_key</span><span class="p">,</span>
        <span class="n">_set_routing_key</span><span class="p">,</span>
        <span class="n">_del_routing_key</span><span class="p">,</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :attr:`~.TableMetadata.partition_key` portion of the primary key,</span>
<span class="sd">        which can be used to determine which nodes are replicas for the query.</span>

<span class="sd">        If the partition key is a composite, a list or tuple must be passed in.</span>
<span class="sd">        Each key component should be in its packed (binary) format, so all</span>
<span class="sd">        components should be strings.</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_serial_consistency_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serial_consistency_level</span>

    <span class="k">def</span> <span class="nf">_set_serial_consistency_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serial_consistency_level</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">serial_consistency_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">is_serial</span><span class="p">(</span><span class="n">serial_consistency_level</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;serial_consistency_level must be either ConsistencyLevel.SERIAL &quot;</span>
                <span class="s2">&quot;or ConsistencyLevel.LOCAL_SERIAL&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serial_consistency_level</span> <span class="o">=</span> <span class="n">serial_consistency_level</span>

    <span class="k">def</span> <span class="nf">_del_serial_consistency_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serial_consistency_level</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">serial_consistency_level</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_serial_consistency_level</span><span class="p">,</span>
        <span class="n">_set_serial_consistency_level</span><span class="p">,</span>
        <span class="n">_del_serial_consistency_level</span><span class="p">,</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The serial consistency level is only used by conditional updates</span>
<span class="sd">        (``INSERT``, ``UPDATE`` and ``DELETE`` with an ``IF`` condition).  For</span>
<span class="sd">        those, the ``serial_consistency_level`` defines the consistency level of</span>
<span class="sd">        the serial phase (or &quot;paxos&quot; phase) while the normal</span>
<span class="sd">        :attr:`~.consistency_level` defines the consistency for the &quot;learn&quot; phase,</span>
<span class="sd">        i.e. what type of reads will be guaranteed to see the update right away.</span>
<span class="sd">        For example, if a conditional write has a :attr:`~.consistency_level` of</span>
<span class="sd">        :attr:`~.ConsistencyLevel.QUORUM` (and is successful), then a</span>
<span class="sd">        :attr:`~.ConsistencyLevel.QUORUM` read is guaranteed to see that write.</span>
<span class="sd">        But if the regular :attr:`~.consistency_level` of that write is</span>
<span class="sd">        :attr:`~.ConsistencyLevel.ANY`, then only a read with a</span>
<span class="sd">        :attr:`~.consistency_level` of :attr:`~.ConsistencyLevel.SERIAL` is</span>
<span class="sd">        guaranteed to see it (even a read with consistency</span>
<span class="sd">        :attr:`~.ConsistencyLevel.ALL` is not guaranteed to be enough).</span>

<span class="sd">        The serial consistency can only be one of :attr:`~.ConsistencyLevel.SERIAL`</span>
<span class="sd">        or :attr:`~.ConsistencyLevel.LOCAL_SERIAL`. While ``SERIAL`` guarantees full</span>
<span class="sd">        linearizability (with other ``SERIAL`` updates), ``LOCAL_SERIAL`` only</span>
<span class="sd">        guarantees it in the local data center.</span>

<span class="sd">        The serial consistency level is ignored for any query that is not a</span>
<span class="sd">        conditional update. Serial reads should use the regular</span>
<span class="sd">        :attr:`consistency_level`.</span>

<span class="sd">        Serial consistency levels may only be used against Cassandra 2.0+</span>
<span class="sd">        and the :attr:`~.Cluster.protocol_version` must be set to 2 or higher.</span>

<span class="sd">        See :doc:`/lwt` for a discussion on how to work with results returned from</span>
<span class="sd">        conditional statements.</span>

<span class="sd">        .. versionadded:: 2.0.0</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SimpleStatement"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.SimpleStatement">[docs]</a><span class="k">class</span> <span class="nc">SimpleStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple, un-prepared query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="n">retry_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">serial_consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_size</span><span class="o">=</span><span class="n">FETCH_SIZE_UNSET</span><span class="p">,</span> <span class="n">keyspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">custom_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_idempotent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `query_string` should be a literal CQL statement with the exception</span>
<span class="sd">        of parameter placeholders that will be filled through the</span>
<span class="sd">        `parameters` argument of :meth:`.Session.execute()`.</span>

<span class="sd">        See :class:`Statement` attributes for a description of the other parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Statement</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retry_policy</span><span class="p">,</span> <span class="n">consistency_level</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span>
                           <span class="n">serial_consistency_level</span><span class="p">,</span> <span class="n">fetch_size</span><span class="p">,</span> <span class="n">keyspace</span><span class="p">,</span> <span class="n">custom_payload</span><span class="p">,</span> <span class="n">is_idempotent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_string</span> <span class="o">=</span> <span class="n">query_string</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">query_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_string</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">consistency</span> <span class="o">=</span> <span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">value_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span><span class="p">,</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&lt;SimpleStatement query=&quot;</span><span class="si">%s</span><span class="s1">&quot;, consistency=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_string</span><span class="p">,</span> <span class="n">consistency</span><span class="p">))</span>
    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span></div>


<div class="viewcode-block" id="PreparedStatement"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.PreparedStatement">[docs]</a><span class="k">class</span> <span class="nc">PreparedStatement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A statement that has been prepared against at least one Cassandra node.</span>
<span class="sd">    Instances of this class should not be created directly, but through</span>
<span class="sd">    :meth:`.Session.prepare()`.</span>

<span class="sd">    A :class:`.PreparedStatement` should be prepared only once. Re-preparing a statement</span>
<span class="sd">    may affect performance (as the operation requires a network roundtrip).</span>

<span class="sd">    |prepared_stmt_head|: Do not use ``*`` in prepared statements if you might</span>
<span class="sd">    change the schema of the table being queried. The driver and server each</span>
<span class="sd">    maintain a map between metadata for a schema and statements that were</span>
<span class="sd">    prepared against that schema. When a user changes a schema, e.g. by adding</span>
<span class="sd">    or removing a column, the server invalidates its mappings involving that</span>
<span class="sd">    schema. However, there is currently no way to propagate that invalidation</span>
<span class="sd">    to drivers. Thus, after a schema change, the driver will incorrectly</span>
<span class="sd">    interpret the results of ``SELECT *`` queries prepared before the schema</span>
<span class="sd">    change. This is currently being addressed in `CASSANDRA-10786</span>
<span class="sd">    &lt;https://issues.apache.org/jira/browse/CASSANDRA-10786&gt;`_.</span>

<span class="sd">    .. |prepared_stmt_head| raw:: html</span>

<span class="sd">       &lt;b&gt;A note about &lt;code&gt;*&lt;/code&gt; in prepared statements&lt;/b&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_metadata</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#TODO: make this bind_metadata in next major</span>
    <span class="n">retry_policy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">consistency_level</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">custom_payload</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fetch_size</span> <span class="o">=</span> <span class="n">FETCH_SIZE_UNSET</span>
    <span class="n">keyspace</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># change to prepared_keyspace in major release</span>
    <span class="n">protocol_version</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">query_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">query_string</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">result_metadata</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">result_metadata_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">routing_key_indexes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_routing_key_index_set</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">serial_consistency_level</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO never used?</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_metadata</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">routing_key_indexes</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span>
                 <span class="n">keyspace</span><span class="p">,</span> <span class="n">protocol_version</span><span class="p">,</span> <span class="n">result_metadata</span><span class="p">,</span> <span class="n">result_metadata_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_metadata</span> <span class="o">=</span> <span class="n">column_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_id</span> <span class="o">=</span> <span class="n">query_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routing_key_indexes</span> <span class="o">=</span> <span class="n">routing_key_indexes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_string</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyspace</span> <span class="o">=</span> <span class="n">keyspace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_version</span> <span class="o">=</span> <span class="n">protocol_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_metadata</span> <span class="o">=</span> <span class="n">result_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_metadata_id</span> <span class="o">=</span> <span class="n">result_metadata_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_idempotent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">column_metadata</span><span class="p">,</span> <span class="n">pk_indexes</span><span class="p">,</span> <span class="n">cluster_metadata</span><span class="p">,</span>
                     <span class="n">query</span><span class="p">,</span> <span class="n">prepared_keyspace</span><span class="p">,</span> <span class="n">protocol_version</span><span class="p">,</span> <span class="n">result_metadata</span><span class="p">,</span>
                     <span class="n">result_metadata_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">column_metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PreparedStatement</span><span class="p">(</span><span class="n">column_metadata</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">prepared_keyspace</span><span class="p">,</span> <span class="n">protocol_version</span><span class="p">,</span> <span class="n">result_metadata</span><span class="p">,</span> <span class="n">result_metadata_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pk_indexes</span><span class="p">:</span>
            <span class="n">routing_key_indexes</span> <span class="o">=</span> <span class="n">pk_indexes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">routing_key_indexes</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">first_col</span> <span class="o">=</span> <span class="n">column_metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ks_meta</span> <span class="o">=</span> <span class="n">cluster_metadata</span><span class="o">.</span><span class="n">keyspaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_col</span><span class="o">.</span><span class="n">keyspace_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ks_meta</span><span class="p">:</span>
                <span class="n">table_meta</span> <span class="o">=</span> <span class="n">ks_meta</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_col</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">table_meta</span><span class="p">:</span>
                    <span class="n">partition_key_columns</span> <span class="o">=</span> <span class="n">table_meta</span><span class="o">.</span><span class="n">partition_key</span>

                    <span class="c1"># make a map of {column_name: index} for each column in the statement</span>
                    <span class="n">statement_indexes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column_metadata</span><span class="p">))</span>

                    <span class="c1"># a list of which indexes in the statement correspond to partition key items</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">routing_key_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">statement_indexes</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                                               <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">partition_key_columns</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># we&#39;re missing a partition key component in the prepared</span>
                        <span class="k">pass</span>          <span class="c1"># statement; just leave routing_key_indexes as None</span>

        <span class="k">return</span> <span class="n">PreparedStatement</span><span class="p">(</span><span class="n">column_metadata</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">routing_key_indexes</span><span class="p">,</span>
                                 <span class="n">query</span><span class="p">,</span> <span class="n">prepared_keyspace</span><span class="p">,</span> <span class="n">protocol_version</span><span class="p">,</span> <span class="n">result_metadata</span><span class="p">,</span>
                                 <span class="n">result_metadata_id</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedStatement.bind"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.PreparedStatement.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and returns a :class:`BoundStatement` instance using `values`.</span>

<span class="sd">        See :meth:`BoundStatement.bind` for rules on input ``values``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BoundStatement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">is_routing_key_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key_index_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key_index_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_key_indexes</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_key_indexes</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key_index_set</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">consistency</span> <span class="o">=</span> <span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">value_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span><span class="p">,</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&lt;PreparedStatement query=&quot;</span><span class="si">%s</span><span class="s1">&quot;, consistency=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_string</span><span class="p">,</span> <span class="n">consistency</span><span class="p">))</span>
    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span></div>


<div class="viewcode-block" id="BoundStatement"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BoundStatement">[docs]</a><span class="k">class</span> <span class="nc">BoundStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A prepared statement that has been bound to a particular set of values.</span>
<span class="sd">    These may be created directly or through :meth:`.PreparedStatement.bind()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prepared_statement</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The :class:`PreparedStatement` instance that this was created from.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sequence of values that were bound to the prepared statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prepared_statement</span><span class="p">,</span> <span class="n">retry_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">serial_consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetch_size</span><span class="o">=</span><span class="n">FETCH_SIZE_UNSET</span><span class="p">,</span> <span class="n">keyspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">custom_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `prepared_statement` should be an instance of :class:`PreparedStatement`.</span>

<span class="sd">        See :class:`Statement` attributes for a description of the other parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span> <span class="o">=</span> <span class="n">prepared_statement</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">retry_policy</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">retry_policy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">consistency_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial_consistency_level</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">serial_consistency_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_size</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">fetch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">custom_payload</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_idempotent</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">is_idempotent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="n">prepared_statement</span><span class="o">.</span><span class="n">column_metadata</span>
        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyspace</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keyspace_name</span>

        <span class="n">Statement</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retry_policy</span><span class="p">,</span> <span class="n">consistency_level</span><span class="p">,</span> <span class="n">routing_key</span><span class="p">,</span>
                           <span class="n">serial_consistency_level</span><span class="p">,</span> <span class="n">fetch_size</span><span class="p">,</span> <span class="n">keyspace</span><span class="p">,</span> <span class="n">custom_payload</span><span class="p">,</span>
                           <span class="n">prepared_statement</span><span class="o">.</span><span class="n">is_idempotent</span><span class="p">)</span>

<div class="viewcode-block" id="BoundStatement.bind"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BoundStatement.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Binds a sequence of values for the prepared statement parameters</span>
<span class="sd">        and returns this instance.  Note that `values` *must* be:</span>

<span class="sd">        * a sequence, even if you are only binding one value, or</span>
<span class="sd">        * a dict that relates 1-to-1 between dict keys and columns</span>

<span class="sd">        .. versionchanged:: 2.6.0</span>

<span class="sd">            :data:`~.UNSET_VALUE` was introduced. These can be bound as positional parameters</span>
<span class="sd">            in a sequence, or by name in a dict. Additionally, when using protocol v4+:</span>

<span class="sd">            * short sequences will be extended to match bind parameters with UNSET_VALUE</span>
<span class="sd">            * names may be omitted from a dict with UNSET_VALUE implied.</span>

<span class="sd">        .. versionchanged:: 3.0.0</span>

<span class="sd">            method will not throw if extra keys are present in bound dict (PYTHON-178)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">proto_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">protocol_version</span>
        <span class="n">col_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">column_metadata</span>

        <span class="c1"># special case for binding dicts</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">values_dict</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># sort values accordingly</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_meta</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values_dict</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">proto_version</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UNSET_VALUE</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="s1">&#39;Column name `</span><span class="si">%s</span><span class="s1">` not found in bound dict.&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">value_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">col_meta_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_meta</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_len</span> <span class="o">&gt;</span> <span class="n">col_meta_len</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Too many arguments provided to bind() (got </span><span class="si">%d</span><span class="s2">, expected </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_meta</span><span class="p">)))</span>

        <span class="c1"># this is fail-fast for clarity pre-v4. When v4 can be assumed,</span>
        <span class="c1"># the error will be better reported when UNSET_VALUE is implicitly added.</span>
        <span class="k">if</span> <span class="n">proto_version</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">routing_key_indexes</span> <span class="ow">and</span> \
           <span class="n">value_len</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">routing_key_indexes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Too few arguments provided to bind() (got </span><span class="si">%d</span><span class="s2">, required </span><span class="si">%d</span><span class="s2"> for routing key)&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">value_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">routing_key_indexes</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raw_values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">col_spec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">col_meta</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">UNSET_VALUE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proto_version</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_unset_value</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Attempt to bind UNSET_VALUE while using unsuitable protocol version (</span><span class="si">%d</span><span class="s2"> &lt; 4)&quot;</span> <span class="o">%</span> <span class="n">proto_version</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_spec</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">proto_version</span><span class="p">))</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">actual_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Received an argument of invalid type for column &quot;</span><span class="si">%s</span><span class="s1">&quot;. &#39;</span>
                               <span class="s1">&#39;Expected: </span><span class="si">%s</span><span class="s1">, Got: </span><span class="si">%s</span><span class="s1">; (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col_spec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col_spec</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">actual_type</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">proto_version</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">col_meta_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_append_unset_value</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_append_unset_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">next_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">is_routing_key_index</span><span class="p">(</span><span class="n">next_index</span><span class="p">):</span>
            <span class="n">col_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">column_metadata</span><span class="p">[</span><span class="n">next_index</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot bind UNSET_VALUE as a part of the routing key &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">col_meta</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UNSET_VALUE</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">routing_key_indexes</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span>

        <span class="n">routing_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">routing_key_indexes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">routing_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">routing_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_parts_packed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">routing_indexes</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_key</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">consistency</span> <span class="o">=</span> <span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">value_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span><span class="p">,</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&lt;BoundStatement query=&quot;</span><span class="si">%s</span><span class="s1">&quot;, values=</span><span class="si">%s</span><span class="s1">, consistency=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">query_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_values</span><span class="p">,</span> <span class="n">consistency</span><span class="p">))</span>
    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span></div>


<div class="viewcode-block" id="BatchType"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BatchType">[docs]</a><span class="k">class</span> <span class="nc">BatchType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A BatchType is used with :class:`.BatchStatement` instances to control</span>
<span class="sd">    the atomicity of the batch operation.</span>

<span class="sd">    .. versionadded:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LOGGED</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atomic batch operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNLOGGED</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Non-atomic batch operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">COUNTER</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Batches of counter operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BatchType.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">)</span></div>


<span class="n">BatchType</span><span class="o">.</span><span class="n">LOGGED</span> <span class="o">=</span> <span class="n">BatchType</span><span class="p">(</span><span class="s2">&quot;LOGGED&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">BatchType</span><span class="o">.</span><span class="n">UNLOGGED</span> <span class="o">=</span> <span class="n">BatchType</span><span class="p">(</span><span class="s2">&quot;UNLOGGED&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BatchType</span><span class="o">.</span><span class="n">COUNTER</span> <span class="o">=</span> <span class="n">BatchType</span><span class="p">(</span><span class="s2">&quot;COUNTER&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="BatchStatement"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BatchStatement">[docs]</a><span class="k">class</span> <span class="nc">BatchStatement</span><span class="p">(</span><span class="n">Statement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A protocol-level batch of operations which are applied atomically</span>
<span class="sd">    by default.</span>

<span class="sd">    .. versionadded:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">batch_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The :class:`.BatchType` for the batch operation.  Defaults to</span>
<span class="sd">    :attr:`.BatchType.LOGGED`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serial_consistency_level</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The same as :attr:`.Statement.serial_consistency_level`, but is only</span>
<span class="sd">    supported when using protocol version 3 or higher.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_statements_and_parameters</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_type</span><span class="o">=</span><span class="n">BatchType</span><span class="o">.</span><span class="n">LOGGED</span><span class="p">,</span> <span class="n">retry_policy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">serial_consistency_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `batch_type` specifies The :class:`.BatchType` for the batch operation.</span>
<span class="sd">        Defaults to :attr:`.BatchType.LOGGED`.</span>

<span class="sd">        `retry_policy` should be a :class:`~.RetryPolicy` instance for</span>
<span class="sd">        controlling retries on the operation.</span>

<span class="sd">        `consistency_level` should be a :class:`~.ConsistencyLevel` value</span>
<span class="sd">        to be used for all operations in the batch.</span>

<span class="sd">        `custom_payload` is a :ref:`custom_payload` passed to the server.</span>
<span class="sd">        Note: as Statement objects are added to the batch, this map is</span>
<span class="sd">        updated with any values found in their custom payloads. These are</span>
<span class="sd">        only allowed when using protocol version 4 or higher.</span>

<span class="sd">        Example usage:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            insert_user = session.prepare(&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;)</span>
<span class="sd">            batch = BatchStatement(consistency_level=ConsistencyLevel.QUORUM)</span>

<span class="sd">            for (name, age) in users_to_insert:</span>
<span class="sd">                batch.add(insert_user, (name, age))</span>

<span class="sd">            session.execute(batch)</span>

<span class="sd">        You can also mix different types of operations within a batch:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            batch = BatchStatement()</span>
<span class="sd">            batch.add(SimpleStatement(&quot;INSERT INTO users (name, age) VALUES (%s, %s)&quot;), (name, age))</span>
<span class="sd">            batch.add(SimpleStatement(&quot;DELETE FROM pending_users WHERE name=%s&quot;), (name,))</span>
<span class="sd">            session.execute(batch)</span>

<span class="sd">        .. versionadded:: 2.0.0</span>

<span class="sd">        .. versionchanged:: 2.1.0</span>
<span class="sd">            Added `serial_consistency_level` as a parameter</span>

<span class="sd">        .. versionchanged:: 2.6.0</span>
<span class="sd">            Added `custom_payload` as a parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_type</span> <span class="o">=</span> <span class="n">batch_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statements_and_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">session</span>
        <span class="n">Statement</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retry_policy</span><span class="o">=</span><span class="n">retry_policy</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="n">consistency_level</span><span class="p">,</span>
                           <span class="n">serial_consistency_level</span><span class="o">=</span><span class="n">serial_consistency_level</span><span class="p">,</span> <span class="n">custom_payload</span><span class="o">=</span><span class="n">custom_payload</span><span class="p">)</span>

<div class="viewcode-block" id="BatchStatement.clear"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BatchStatement.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a convenience method to clear a batch statement for reuse.</span>

<span class="sd">        *Note:* it should not be used concurrently with uncompleted execution futures executing the same</span>
<span class="sd">        ``BatchStatement``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statements_and_parameters</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyspace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routing_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="BatchStatement.add"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BatchStatement.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a :class:`.Statement` and optional sequence of parameters</span>
<span class="sd">        to be used with the statement to the batch.</span>

<span class="sd">        Like with other statements, parameters must be a sequence, even</span>
<span class="sd">        if there is only one item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">encoder</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="n">bind_params</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_statement_and_params</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">PreparedStatement</span><span class="p">):</span>
            <span class="n">query_id</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">query_id</span>
            <span class="n">bound_statement</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">bind</span><span class="p">(()</span> <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">bound_statement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_statement_and_params</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">bound_statement</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">BoundStatement</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Parameters cannot be passed with a BoundStatement &quot;</span>
                    <span class="s2">&quot;to BatchStatement.add()&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_statement_and_params</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">prepared_statement</span><span class="o">.</span><span class="n">query_id</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># it must be a SimpleStatement</span>
            <span class="n">query_string</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">query_string</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">encoder</span>
                <span class="n">query_string</span> <span class="o">=</span> <span class="n">bind_params</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_statement_and_params</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">query_string</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="BatchStatement.add_all"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.BatchStatement.add_all">[docs]</a>    <span class="k">def</span> <span class="nf">add_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a sequence of :class:`.Statement` objects and a matching sequence</span>
<span class="sd">        of parameters to the batch. Statement and parameter sequences must be of equal length or</span>
<span class="sd">        one will be truncated. :const:`None` can be used in the parameters position where are needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">statement</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_statement_and_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_prepared</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statements_and_parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0xFFFF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Batch statement cannot contain more than </span><span class="si">%d</span><span class="s2"> statements.&quot;</span> <span class="o">%</span> <span class="mh">0xFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statements_and_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">is_prepared</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_maybe_set_routing_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">routing_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">keyspace</span> <span class="ow">and</span> <span class="n">statement</span><span class="o">.</span><span class="n">routing_key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">routing_key</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">routing_key</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyspace</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="n">keyspace</span>

    <span class="k">def</span> <span class="nf">_update_custom_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">custom_payload</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">custom_payload</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">statement</span><span class="o">.</span><span class="n">custom_payload</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_set_routing_attributes</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_custom_payload</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statements_and_parameters</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">consistency</span> <span class="o">=</span> <span class="n">ConsistencyLevel</span><span class="o">.</span><span class="n">value_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consistency_level</span><span class="p">,</span> <span class="s1">&#39;Not Set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&lt;BatchStatement type=</span><span class="si">%s</span><span class="s1">, statements=</span><span class="si">%d</span><span class="s1">, consistency=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">consistency</span><span class="p">))</span>
    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span></div>


<span class="n">ValueSequence</span> <span class="o">=</span> <span class="n">cassandra</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">ValueSequence</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A wrapper class that is used to specify that a sequence of values should</span>
<span class="sd">be treated as a CQL list of values instead of a single column collection when used</span>
<span class="sd">as part of the `parameters` argument for :meth:`.Session.execute()`.</span>

<span class="sd">This is typically needed when supplying a list of keys to select.</span>
<span class="sd">For example::</span>

<span class="sd">    &gt;&gt;&gt; my_user_ids = (&#39;alice&#39;, &#39;bob&#39;, &#39;charles&#39;)</span>
<span class="sd">    &gt;&gt;&gt; query = &quot;SELECT * FROM users WHERE user_id IN %s&quot;</span>
<span class="sd">    &gt;&gt;&gt; session.execute(query, parameters=[ValueSequence(my_user_ids)])</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">bind_params</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">encoder</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">query</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">encoder</span><span class="o">.</span><span class="n">cql_encode_all_types</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">query</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">cql_encode_all_types</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)</span>


<div class="viewcode-block" id="TraceUnavailable"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.TraceUnavailable">[docs]</a><span class="k">class</span> <span class="nc">TraceUnavailable</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised when complete trace details cannot be fetched from Cassandra.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="QueryTrace"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.QueryTrace">[docs]</a><span class="k">class</span> <span class="nc">QueryTrace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trace of the duration and events that occurred when executing</span>
<span class="sd">    an operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">trace_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :class:`uuid.UUID` unique identifier for this tracing session.  Matches</span>
<span class="sd">    the ``session_id`` column in ``system_traces.sessions`` and</span>
<span class="sd">    ``system_traces.events``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">request_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A string that very generally describes the traced operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`datetime.timedelta` measure of the duration of the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The IP address of the client that issued this request</span>

<span class="sd">    This is only available when using Cassandra 2.2+</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">coordinator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The IP address of the host that acted as coordinator for this request.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`dict` of parameters for the traced operation, such as the</span>
<span class="sd">    specific query string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">started_at</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A UTC :class:`datetime.datetime` object describing when the operation</span>
<span class="sd">    was started.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">events</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A chronologically sorted list of :class:`.TraceEvent` instances</span>
<span class="sd">    representing the steps the traced operation went through.  This</span>
<span class="sd">    corresponds to the rows in ``system_traces.events`` for this tracing</span>
<span class="sd">    session.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_SELECT_SESSIONS_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM system_traces.sessions WHERE session_id = </span><span class="si">%s</span><span class="s2">&quot;</span>
    <span class="n">_SELECT_EVENTS_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM system_traces.events WHERE session_id = </span><span class="si">%s</span><span class="s2">&quot;</span>
    <span class="n">_BASE_RETRY_SLEEP</span> <span class="o">=</span> <span class="mf">0.003</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_id</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">session</span>

<div class="viewcode-block" id="QueryTrace.populate"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.QueryTrace.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_wait</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">wait_for_complete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">query_cl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the actual tracing details from Cassandra and populates the</span>
<span class="sd">        attributes of this instance.  Because tracing details are stored</span>
<span class="sd">        asynchronously by Cassandra, this may need to retry the session</span>
<span class="sd">        detail fetch.  If the trace is still not available after `max_wait`</span>
<span class="sd">        seconds, :exc:`.TraceUnavailable` will be raised; if `max_wait` is</span>
<span class="sd">        :const:`None`, this will retry forever.</span>

<span class="sd">        `wait_for_complete=False` bypasses the wait for duration to be populated.</span>
<span class="sd">        This can be used to query events from partial sessions.</span>

<span class="sd">        `query_cl` specifies a consistency level to use for polling the trace tables,</span>
<span class="sd">        if it should be different than the session default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
            <span class="k">if</span> <span class="n">max_wait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time_spent</span> <span class="o">&gt;=</span> <span class="n">max_wait</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraceUnavailable</span><span class="p">(</span>
                    <span class="s2">&quot;Trace information was not available within </span><span class="si">%f</span><span class="s2"> seconds. Consider raising Session.max_trace_wait.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_wait</span><span class="p">,))</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to fetch trace info for trace ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">)</span>
            <span class="n">session_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span>
                <span class="n">SimpleStatement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECT_SESSIONS_FORMAT</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="n">query_cl</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,),</span> <span class="n">time_spent</span><span class="p">,</span> <span class="n">max_wait</span><span class="p">)</span>

            <span class="c1"># PYTHON-730: There is race condition that the duration mutation is written before started_at the for fast queries</span>
            <span class="n">is_complete</span> <span class="o">=</span> <span class="n">session_results</span> <span class="ow">and</span> <span class="n">session_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">session_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">started_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">session_results</span> <span class="ow">or</span> <span class="p">(</span><span class="n">wait_for_complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_complete</span><span class="p">):</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_BASE_RETRY_SLEEP</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">))</span>
                <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">is_complete</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetched trace info for trace ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching parital trace info for trace ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">)</span>

            <span class="n">session_row</span> <span class="o">=</span> <span class="n">session_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_type</span> <span class="o">=</span> <span class="n">session_row</span><span class="o">.</span><span class="n">request</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="n">session_row</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_complete</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">started_at</span> <span class="o">=</span> <span class="n">session_row</span><span class="o">.</span><span class="n">started_at</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span> <span class="o">=</span> <span class="n">session_row</span><span class="o">.</span><span class="n">coordinator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">session_row</span><span class="o">.</span><span class="n">parameters</span>
            <span class="c1"># since C* 2.2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">session_row</span><span class="p">,</span> <span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to fetch trace events for trace ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">)</span>
            <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
            <span class="n">event_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span>
                <span class="n">SimpleStatement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECT_EVENTS_FORMAT</span><span class="p">,</span> <span class="n">consistency_level</span><span class="o">=</span><span class="n">query_cl</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,),</span> <span class="n">time_spent</span><span class="p">,</span> <span class="n">max_wait</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetched trace events for trace ID: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">TraceEvent</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">activity</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">source_elapsed</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">thread</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">event_results</span><span class="p">)</span>
            <span class="k">break</span></div>

    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">time_spent</span><span class="p">,</span> <span class="n">max_wait</span><span class="p">):</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_wait</span> <span class="o">-</span> <span class="n">time_spent</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_wait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">_create_response_future</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="c1"># in case the user switched the row factory, set it to namedtuple for this query</span>
        <span class="n">future</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">named_tuple_factory</span>
        <span class="n">future</span><span class="o">.</span><span class="n">send_request</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationTimedOut</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraceUnavailable</span><span class="p">(</span><span class="s2">&quot;Trace information was not available within </span><span class="si">%f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_wait</span><span class="p">,))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">] coordinator: </span><span class="si">%s</span><span class="s2">, started at: </span><span class="si">%s</span><span class="s2">, duration: </span><span class="si">%s</span><span class="s2">, parameters: </span><span class="si">%s</span><span class="s2">&quot;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_at</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span></div>


<div class="viewcode-block" id="TraceEvent"><a class="viewcode-back" href="../../../api/cassandra/query/#cassandra.cluster.TraceEvent">[docs]</a><span class="k">class</span> <span class="nc">TraceEvent</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a single event within a query trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A brief description of the event.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A UTC :class:`datetime.datetime` marking when the event occurred.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The IP address of the node this event occurred on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source_elapsed</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`datetime.timedelta` measuring the amount of time until</span>
<span class="sd">    this event occurred starting from when :attr:`.source` first</span>
<span class="sd">    received the query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">thread_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The name of the thread that this event occurred on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">timeuuid</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_elapsed</span><span class="p">,</span> <span class="n">thread_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">unix_time_from_uuid1</span><span class="p">(</span><span class="n">timeuuid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="k">if</span> <span class="n">source_elapsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_elapsed</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="n">source_elapsed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_elapsed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_name</span> <span class="o">=</span> <span class="n">thread_name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">] at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span></div>


<span class="c1"># TODO remove next major since we can target using the `host` attribute of session.execute</span>
<span class="k">class</span> <span class="nc">HostTargetingStatement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps any query statement and attaches a target host, making</span>
<span class="sd">    it usable in a targeted LBP without modifying the user&#39;s statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_statement</span><span class="p">,</span> <span class="n">target_host</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">inner_statement</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">inner_statement</span><span class="o">.</span><span class="vm">__class__</span><span class="p">),</span>
                                  <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">inner_statement</span><span class="o">.</span><span class="vm">__dict__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_host</span> <span class="o">=</span> <span class="n">target_host</span>
</pre></div>
        </div>

        <div id="sidebar" class="large-3 large-pull-9 columns"><div class="side-nav">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrading/">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../execution_profiles/">Execution Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance/">Performance Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../query_paging/">Paging Large Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lwt/">Lightweight Transactions (Compare-and-set)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_defined_types/">User Defined Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../object_mapper/">Object Mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geo_types/">DSE Geometry Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../graph/">DataStax Graph Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../graph_fluent/">DataStax Graph Fluent API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dates_and_times/">Working with Dates and Times</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud/">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/">Frequently Asked Questions</a></li>
</ul>

</div>
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close"></a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/python-driver/issues/new?title=Issue in page cassandra.query&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/_modules/cassandra/query%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2013-2017 DataStax
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../../../_static/js/vendor/jquery.js"></script>
<script src="../../../_static/expertrec.js"></script>
<script src="../../../_static/js/foundation/foundation.js"></script>
<script src="../../../_static/js/foundation/foundation.topbar.js"></script>
<script src="../../../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>